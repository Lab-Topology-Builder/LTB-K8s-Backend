
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Kubernetes Operator and User management for the Lab Topology Builder.">
      
      
        <meta name="author" content="Jan Untersander, Tsigereda Nebai Kidane">
      
      
        <link rel="canonical" href="https://lab-topology-builder.github.io/LTB-K8s-Backend/contributions/dev-cluster-setup/">
      
      
        <link rel="prev" href="../coding-conventions/">
      
      
        <link rel="next" href="../technologies-used/">
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.13">
    
    
      
        <title>Development Cluster Setup - LTB K8s Backend</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ffa9267a.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#development-cluster-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LTB K8s Backend" class="md-header__button md-logo" aria-label="LTB K8s Backend" data-md-component="logo">
      
  <img src="../../assets/images/LTB_Text_RGB.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LTB K8s Backend
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Development Cluster Setup
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Lab-Topology-Builder/LTB-K8s-Backend/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Lab-Topology-Builder/LTB-K8s-Backend
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LTB K8s Backend" class="md-nav__button md-logo" aria-label="LTB K8s Backend" data-md-component="logo">
      
  <img src="../../assets/images/LTB_Text_RGB.svg" alt="logo">

    </a>
    LTB K8s Backend
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Lab-Topology-Builder/LTB-K8s-Backend/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Lab-Topology-Builder/LTB-K8s-Backend
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/" class="md-nav__link">
        User Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Contributions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Contributions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributor-guide/" class="md-nav__link">
        Contributor Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../coding-conventions/" class="md-nav__link">
        Coding Conventions
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Development Cluster Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Development Cluster Setup
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-remote-cluster" class="md-nav__link">
    Prerequisites Remote Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-node" class="md-nav__link">
    Prepare Node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rke2-server-configuration" class="md-nav__link">
    RKE2 Server Configuration
  </a>
  
    <nav class="md-nav" aria-label="RKE2 Server Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cilium-configuration-for-multus" class="md-nav__link">
    Cilium Configuration for Multus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-and-start-server-and-check-logs" class="md-nav__link">
    Install and start Server and check logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-kubernetes-tools-to-path-and-set-kubeconfig" class="md-nav__link">
    Add Kubernetes tools to path and set kubeconfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-token-for-agent" class="md-nav__link">
    Get Token for Agent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rke2-agent-configuration-optional" class="md-nav__link">
    RKE2 Agent Configuration (Optional)
  </a>
  
    <nav class="md-nav" aria-label="RKE2 Agent Configuration (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-and-start-agent-and-check-logs" class="md-nav__link">
    Install and start Agent and check logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-cluster-network-addons-operator" class="md-nav__link">
    Install Cluster Network Addons Operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubevirt" class="md-nav__link">
    Kubevirt
  </a>
  
    <nav class="md-nav" aria-label="Kubevirt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validate-hardware-virtualization-support" class="md-nav__link">
    Validate Hardware Virtualization Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubevirt" class="md-nav__link">
    Install Kubevirt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-containerized-data-importer" class="md-nav__link">
    Install Containerized Data Importer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-virtctl-via-krew" class="md-nav__link">
    Install virtctl via Krew
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
    <nav class="md-nav" aria-label="MetalLB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-operator-lifecycle-manager-olm" class="md-nav__link">
    Install Operator Lifecycle Manager (OLM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-development-cluster" class="md-nav__link">
    Local development cluster
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../technologies-used/" class="md-nav__link">
        Tools and Frameworks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../test-concepts/" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/k8s-ltb-architecture/" class="md-nav__link">
        Kubernetes Lab Topology Builder Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/kvm-docker-ltb-architecture/" class="md-nav__link">
        Preliminary Work (KVM/Docker)-based LTB Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Decisions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Decisions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0000-use-markdown-architectural-decision-records/" class="md-nav__link">
        Use Markdown Architectural Decision Records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0001-operator-SDK/" class="md-nav__link">
        Operator SDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/00011-remote-access/" class="md-nav__link">
        Remote-Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0002-operator-scope/" class="md-nav__link">
        Operator Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0003-api-and-operator-deployment/" class="md-nav__link">
        API and Operator Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0004-dev-container/" class="md-nav__link">
        Dev Container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0005-replace-current-ltb-backend/" class="md-nav__link">
        Replace Current LTB Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0006-lab-instance-set/" class="md-nav__link">
        Lab Instance Set
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0007-interaction-with-operator/" class="md-nav__link">
        Interaction with Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0008-namespace-per-labinstance/" class="md-nav__link">
        Namespace Per LabInstance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0009-k8s-aggreted-api-over-standalone-api/" class="md-nav__link">
        K8s Aggreted API Over Standalone API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0010-extending-ltb-with-new-node-types/" class="md-nav__link">
        Extending LTB with New Node Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decisions/0011-programming-language/" class="md-nav__link">
        Programming Language
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites-remote-cluster" class="md-nav__link">
    Prerequisites Remote Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-node" class="md-nav__link">
    Prepare Node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rke2-server-configuration" class="md-nav__link">
    RKE2 Server Configuration
  </a>
  
    <nav class="md-nav" aria-label="RKE2 Server Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cilium-configuration-for-multus" class="md-nav__link">
    Cilium Configuration for Multus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-and-start-server-and-check-logs" class="md-nav__link">
    Install and start Server and check logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-kubernetes-tools-to-path-and-set-kubeconfig" class="md-nav__link">
    Add Kubernetes tools to path and set kubeconfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-token-for-agent" class="md-nav__link">
    Get Token for Agent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rke2-agent-configuration-optional" class="md-nav__link">
    RKE2 Agent Configuration (Optional)
  </a>
  
    <nav class="md-nav" aria-label="RKE2 Agent Configuration (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-and-start-agent-and-check-logs" class="md-nav__link">
    Install and start Agent and check logs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-cluster-network-addons-operator" class="md-nav__link">
    Install Cluster Network Addons Operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubevirt" class="md-nav__link">
    Kubevirt
  </a>
  
    <nav class="md-nav" aria-label="Kubevirt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validate-hardware-virtualization-support" class="md-nav__link">
    Validate Hardware Virtualization Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubevirt" class="md-nav__link">
    Install Kubevirt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-containerized-data-importer" class="md-nav__link">
    Install Containerized Data Importer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-virtctl-via-krew" class="md-nav__link">
    Install virtctl via Krew
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
    <nav class="md-nav" aria-label="MetalLB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-operator-lifecycle-manager-olm" class="md-nav__link">
    Install Operator Lifecycle Manager (OLM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-development-cluster" class="md-nav__link">
    Local development cluster
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/Lab-Topology-Builder/LTB-K8s-Backend/blob/main/docs/contributions/dev-cluster-setup.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="development-cluster-setup">Development cluster setup<a class="headerlink" href="#development-cluster-setup" title="Permanent link">&para;</a></h1>
<p>Steps to setup a Kubernetes development cluster for testing and development of the <abbr title="Lab Topology Builder">LTB</abbr> operator.</p>
<h2 id="prerequisites-remote-cluster">Prerequisites Remote Cluster<a class="headerlink" href="#prerequisites-remote-cluster" title="Permanent link">&para;</a></h2>
<ul>
<li>Server with Linux OS (Recommended Ubuntu 22.04)</li>
</ul>
<h2 id="prepare-node">Prepare Node<a class="headerlink" href="#prepare-node" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y
sudo<span class="w"> </span>swapoff<span class="w"> </span>-a
sudo<span class="w"> </span>sed<span class="w"> </span>-ri<span class="w"> </span><span class="s1">&#39;/\sswap\s/s/^#?/#/&#39;</span><span class="w"> </span>/etc/fstab
</code></pre></div>
<h2 id="rke2-server-configuration">RKE2 Server Configuration<a class="headerlink" href="#rke2-server-configuration" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/rancher/rke2
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/rancher/rke2/config.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rancher/rke2/config.yaml</span>
<span class="nt">write-kubeconfig-mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0644&quot;</span>
<span class="nt">kube-apiserver-arg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-privileged=true&quot;</span>
<span class="nt">cni</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multus,cilium</span>
<span class="nt">disable-kube-proxy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<h3 id="cilium-configuration-for-multus">Cilium Configuration for Multus<a class="headerlink" href="#cilium-configuration-for-multus" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/rancher/rke2/server/manifests
sudo<span class="w"> </span>vim<span class="w"> </span>/var/lib/rancher/rke2/server/manifests/rke2-cilium-config.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># /var/lib/rancher/rke2/server/manifests/rke2-cilium-config.yaml</span>
<span class="c1"># k8sServiceHost/Port IP of Control Plane node default Port 6443</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm.cattle.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HelmChartConfig</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rke2-cilium</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">valuesContent</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">cni:</span>
<span class="w">      </span><span class="no">chainingMode: &quot;none&quot;</span>
<span class="w">      </span><span class="no">exclusive: false</span>
<span class="w">    </span><span class="no">kubeProxyReplacement: strict</span>
<span class="w">    </span><span class="no">k8sServiceHost: &quot;&lt;NodeIP&gt;&quot;</span>
<span class="w">    </span><span class="no">k8sServicePort: 6443</span>
<span class="w">    </span><span class="no">operator:</span>
<span class="w">      </span><span class="no">replicas: 1</span>
</code></pre></div>
<h3 id="install-and-start-server-and-check-logs">Install and start Server and check logs<a class="headerlink" href="#install-and-start-server-and-check-logs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sfL<span class="w"> </span>https://get.rke2.io<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">INSTALL_RKE2_VERSION</span><span class="o">=</span>v1.26.0+rke2r2<span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>sh<span class="w"> </span>-
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rke2-server.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>rke2-server.service
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>rke2-server<span class="w"> </span>-f
</code></pre></div>
<h3 id="add-kubernetes-tools-to-path-and-set-kubeconfig">Add Kubernetes tools to path and set kubeconfig<a class="headerlink" href="#add-kubernetes-tools-to-path-and-set-kubeconfig" title="Permanent link">&para;</a></h3>
<p>Adds kubectl, crictl and ctr to path</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;$PATH:/var/lib/rancher/rke2/bin&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;source &lt;(kubectl completion bash)&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;alias k=kubectl&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;complete -o default -F __start_kubectl k&#39;</span><span class="w"> </span>&gt;&gt;~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
mkdir<span class="w"> </span>~/.kube
ln<span class="w"> </span>-s<span class="w"> </span>/etc/rancher/rke2/rke2.yaml<span class="w"> </span>~/.kube/config
</code></pre></div>
<h3 id="get-token-for-agent">Get Token for Agent<a class="headerlink" href="#get-token-for-agent" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cat<span class="w"> </span>/var/lib/rancher/rke2/server/node-token
</code></pre></div>
<h2 id="rke2-agent-configuration-optional">RKE2 Agent Configuration (Optional)<a class="headerlink" href="#rke2-agent-configuration-optional" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/rancher/rke2
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/rancher/rke2/config.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rancher/rke2/config.yaml</span>
<span class="nn">---</span>
<span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://&lt;server&gt;:9345</span>
<span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;token from server node&gt;</span>
</code></pre></div>
<h3 id="install-and-start-agent-and-check-logs">Install and start Agent and check logs<a class="headerlink" href="#install-and-start-agent-and-check-logs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sfL<span class="w"> </span>https://get.rke2.io<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">INSTALL_RKE2_TYPE</span><span class="o">=</span><span class="s2">&quot;agent&quot;</span><span class="w"> </span><span class="nv">INSTALL_RKE2_VERSION</span><span class="o">=</span>v1.26.0+rke2r2<span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>sh<span class="w"> </span>-
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rke2-agent.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>rke2-agent.service
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>rke2-agent<span class="w"> </span>-f
</code></pre></div>
<h2 id="install-cluster-network-addons-operator">Install Cluster Network Addons Operator<a class="headerlink" href="#install-cluster-network-addons-operator" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/kubevirt/cluster-network-addons-operator">Cluster Network Addons Operator</a> can be used to deploy additional networking components.
Multus and Cilium are already installed via RKE2.
Open vSwitch CNI Plugin can be installed via this operator.</p>
<p>First install the operator itself:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/cluster-network-addons-operator/releases/download/v0.85.0/namespace.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/cluster-network-addons-operator/releases/download/v0.85.0/network-addons-config.crd.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/cluster-network-addons-operator/releases/download/v0.85.0/operator.yaml
</code></pre></div>
<p>Then you need to create a configuration for the operator example <abbr title="Custom Resource">CR</abbr>:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/cluster-network-addons-operator/releases/download/v0.85.0/network-addons-config-example.cr.yaml
</code></pre></div>
<p>Wait until the operator has finished the installation:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>networkaddonsconfig<span class="w"> </span>cluster<span class="w"> </span>--for<span class="w"> </span><span class="nv">condition</span><span class="o">=</span>Available
</code></pre></div>
<h2 id="kubevirt">Kubevirt<a class="headerlink" href="#kubevirt" title="Permanent link">&para;</a></h2>
<p><a href="https://kubevirt.io/">Kubevirt</a> is a Kubernetes add-on to run virtual machines.</p>
<h3 id="validate-hardware-virtualization-support">Validate Hardware Virtualization Support<a class="headerlink" href="#validate-hardware-virtualization-support" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libvirt-clients
sudo<span class="w"> </span>virt-host-validate<span class="w"> </span>qemu
</code></pre></div>
<h3 id="install-kubevirt">Install Kubevirt<a class="headerlink" href="#install-kubevirt" title="Permanent link">&para;</a></h3>
<p>Latest Release: <code>export RELEASE=$(curl https://storage.googleapis.com/kubevirt-prow/release/kubevirt/kubevirt/stable.txt)</code></p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">RELEASE</span><span class="o">=</span>v0.58.1
<span class="c1"># Deploy the KubeVirt operator</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/kubevirt/releases/download/<span class="si">${</span><span class="nv">RELEASE</span><span class="si">}</span>/kubevirt-operator.yaml
<span class="c1"># Create the KubeVirt CR (instance deployment request) which triggers the actual installation</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/kubevirt/releases/download/<span class="si">${</span><span class="nv">RELEASE</span><span class="si">}</span>/kubevirt-cr.yaml
<span class="c1"># wait until all KubeVirt components are up</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>kubevirt<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>kv<span class="w"> </span>kubevirt<span class="w"> </span>--for<span class="w"> </span><span class="nv">condition</span><span class="o">=</span>Available
</code></pre></div>
<h3 id="install-containerized-data-importer">Install Containerized Data Importer<a class="headerlink" href="#install-containerized-data-importer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CDI_VERSION</span><span class="o">=</span>v1.55.2
kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>cdi
kubectl<span class="w"> </span>-n<span class="w"> </span>cdi<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/containerized-data-importer/releases/download/<span class="nv">$CDI_VERSION</span>/cdi-operator.yaml
kubectl<span class="w"> </span>-n<span class="w"> </span>cdi<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubevirt/containerized-data-importer/releases/download/<span class="nv">$CDI_VERSION</span>/cdi-cr.yaml
</code></pre></div>
<h3 id="install-virtctl-via-krew">Install virtctl via Krew<a class="headerlink" href="#install-virtctl-via-krew" title="Permanent link">&para;</a></h3>
<p>First install Krew and then install virtctl via Krew</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>
<span class="w">  </span><span class="nb">set</span><span class="w"> </span>-x<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>mktemp<span class="w"> </span>-d<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nv">OS</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>uname<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;[:upper:]&#39;</span><span class="w"> </span><span class="s1">&#39;[:lower:]&#39;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nv">ARCH</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/x86_64/amd64/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/\(arm\)\(64\)\?.*/\1\2/&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/aarch64$/arm64/&#39;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span><span class="nv">KREW</span><span class="o">=</span><span class="s2">&quot;krew-</span><span class="si">${</span><span class="nv">OS</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">ARCH</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span>curl<span class="w"> </span>-fsSLO<span class="w"> </span><span class="s2">&quot;https://github.com/kubernetes-sigs/krew/releases/latest/download/</span><span class="si">${</span><span class="nv">KREW</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span>tar<span class="w"> </span>zxvf<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">KREW</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">  </span>./<span class="s2">&quot;</span><span class="si">${</span><span class="nv">KREW</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>install<span class="w"> </span>krew
<span class="o">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;${KREW_ROOT:-$HOME/.krew}/bin:$PATH&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
kubectl<span class="w"> </span>krew<span class="w"> </span>install<span class="w"> </span>virt
kubectl<span class="w"> </span>virt<span class="w"> </span><span class="nb">help</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">You are ready to go!</p>
<p>You're now ready to use the cluster for development or testing purposes.</p>
</div>
<h2 id="metallb">MetalLB<a class="headerlink" href="#metallb" title="Permanent link">&para;</a></h2>
<p>You can optionally install MetalLB, currently it is not required to use the <abbr title="Lab Topology Builder">LTB</abbr> operator.
<a href="https://metallb.universe.tf/">MetalLB</a> is a load-balancer implementation for bare metal Kubernetes clusters.</p>
<h3 id="install-operator-lifecycle-manager-olm">Install Operator Lifecycle Manager (OLM)<a class="headerlink" href="#install-operator-lifecycle-manager-olm" title="Permanent link">&para;</a></h3>
<p>Install Operator Lifecycle Manager (OLM), a tool to help manage the Operators running on your cluster.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-sL<span class="w"> </span>https://github.com/operator-framework/operator-lifecycle-manager/releases/download/v0.24.0/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash<span class="w"> </span>-s<span class="w"> </span>v0.24.0
</code></pre></div>
<p>Install the operator by running the following command:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>https://operatorhub.io/install/metallb-operator.yaml
</code></pre></div>
<p>This Operator will be installed in the "operators" namespace and will be usable from all namespaces in the cluster.</p>
<p>After install, watch your operator come up using next command.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>csv<span class="w"> </span>-n<span class="w"> </span>operators
</code></pre></div>
<p>Now create a MetalLB IPAddressPool <abbr title="Custom Resource">CR</abbr> to configure the IP address range that MetalLB will use:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>vim<span class="w"> </span>metallb-ipaddresspool.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># metallb-ipaddresspool.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPAddressPool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operators</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">addresses</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X.X.X.X/XX</span>
</code></pre></div>
<p>Create a L2Advertisement to tell MetalLB to responde to ARP requests for all IP address pools (no named ip address pool, means all pools):</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>vim<span class="w"> </span>l2advertisment.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># l2advertisment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2Advertisement</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">operators</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ipAddressPools</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</code></pre></div>
<p>Apply the configuration:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb-ipaddresspool.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>l2advertisment.yaml
</code></pre></div>
<h2 id="storage">Storage<a class="headerlink" href="#storage" title="Permanent link">&para;</a></h2>
<p>To store your virtual machine images and disks you may want to use a storage backend.
Currently no storage backend has been tested with the <abbr title="Lab Topology Builder">LTB</abbr> operator, but you can try to use <a href="https://docs.netapp.com/us-en/trident/index.html">Trident</a>.
Trident is a dynamic storage provisioner for Kubernetes, it supports many storage backends, including NetApp, AWS, Azure, Google Cloud, and many more.</p>
<p>Following you will find some instructions that may help you to install Trident on your cluster.</p>
<p>You always can find more information about Trident in the <a href="https://docs.netapp.com/us-en/trident/index.html">official documentation</a>.</p>
<p>Check connectivity to NetApp Storage:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>--tty<span class="w"> </span>ping<span class="w"> </span>--image<span class="o">=</span>busybox<span class="w"> </span>--restart<span class="o">=</span>Never<span class="w"> </span>--rm<span class="w"> </span>--<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ping<span class="w"> </span>&lt;NetApp<span class="w"> </span>Management<span class="w"> </span>IP&gt;
</code></pre></div>
<p>Download and extract the Trident installer:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">TRIDENT_VERSION</span><span class="o">=</span><span class="m">23</span>.01.0
wget<span class="w"> </span>https://github.com/NetApp/trident/releases/download/v<span class="nv">$TRIDENT_VERSION</span>/trident-installer-<span class="nv">$TRIDENT_VERSION</span>.tar.gz
tar<span class="w"> </span>-xf<span class="w"> </span>trident-installer-<span class="nv">$TRIDENT_VERSION</span>.tar.gz
<span class="nb">cd</span><span class="w"> </span>trident-installer
mkdir<span class="w"> </span>setup
vim<span class="w"> </span>./setup/backend.json
</code></pre></div>
<p>Configure the installer:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ./backend.json</span>
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s2">&quot;storageDriverName&quot;</span>:<span class="w"> </span><span class="s2">&quot;ontap-nas&quot;</span>,
<span class="w">    </span><span class="s2">&quot;managementLIF&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;NetApp Management IP&gt;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;dataLIF&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;NetApp Data IP&gt;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;svm&quot;</span>:<span class="w"> </span><span class="s2">&quot;svm_k8s&quot;</span>,
<span class="w">    </span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="s2">&quot;admin&quot;</span>,
<span class="w">    </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;NetApp Password&gt;&quot;</span>,
<span class="w">    </span><span class="s2">&quot;storagePrefix&quot;</span>:<span class="w"> </span><span class="s2">&quot;trident_&quot;</span>,
<span class="w">    </span><span class="s2">&quot;nfsMountOptions&quot;</span>:<span class="w"> </span><span class="s2">&quot;-o nfsvers=4.1 -o mountport=2049 -o nolock&quot;</span>,
<span class="w">    </span><span class="s2">&quot;debug&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="o">}</span>
</code></pre></div>
<p>Install Trident:</p>
<div class="highlight"><pre><span></span><code>./tridentctl<span class="w"> </span>install<span class="w"> </span>-n<span class="w"> </span>trident<span class="w"> </span>-f<span class="w"> </span>./setup/backend.json
</code></pre></div>
<p>Check the installation:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>trident
</code></pre></div>
<h2 id="local-development-cluster">Local development cluster<a class="headerlink" href="#local-development-cluster" title="Permanent link">&para;</a></h2>
<p><a href="https://k3d.io">K3d</a>, <a href="https://minikube.sigs.k8s.io/docs/">Minikube</a> or <a href="https://kind.sigs.k8s.io/">Kind</a> can be used to run a local Kubernetes cluster, if you don't have access to a remote cluster/server.</p>
<p>Make sure to install the following tools:</p>
<ul>
<li><a href="https://kubevirt.io/">KubeVirt</a></li>
<li><a href="https://github.com/kubevirt/containerized-data-importer">Containerized Data Importer</a></li>
<li><a href="https://github.com/kubevirt/cluster-network-addons-operator">Cluster Network Addon Operator</a></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">KubeVirt may not work properly on local development clusters</p>
<p>KubeVirt may not work properly on local development clusters, because it requires nested virtualization support, which is not available on all local development clusters.
Make sure to enable nested virtualization on your local machine, if you want to run KubeVirt on a local development cluster.</p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Jan Untersander, Tsigereda Nebai Kidane
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Lab-Topology-Builder/LTB-K8s-Backend" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "search.suggest", "content.action.edit", "content.code.copy", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>